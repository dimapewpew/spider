# Распределенное выполнение тяжелых процессов

### Задача

Написать многопоточную службу для распараллеливания ресурсоемких 
задач между несколькими процессами/серверами.

Из чего должен состоять сервис:
* Модуль управления
* Воркер

Модуль управления должен уметь:
* принимать и добавлять новые задачи в пул задач
* запускать и контролировать выполнение воркеров по задачам
* иметь интерфейс управления
* иметь конфигурационный файл, в котором задается максимальное количество воркеров

Воркеры должны уметь:
* запускаться по получению задачи от модуля управления
* уметь работать параллельно с n других воркеров над одной задачей
* писать результаты выполнения в лог

Ограничение: нельзя использовать pthread, а также готовые решения 
для очередей (например RabbitMQ). При использовании других сторонних 
библиотек аргументировать их необходимость.

### Решение

Сервис запускается и стартует заданное количество воркер-процессов. 
Каждый из воркеров соединяется с сервисом через сокет, и запрашивает 
задания для работы. Если воркер считает задание сложным, он разбивает 
его на части и возвращает сервису, в остальных случаях выполняет и 
запрашивает следующее задание.

В экспериментальных целях воркеры ничего не делают с файлами, а просто 
ждут случайное время через sleep().

### Установка

Для работы достаточно PHP 5/7 со стандартными модулями.

### Конфигурация

Настройки задаются в файле `config.php`

* host - ip-адрес `127.0.0.1`
* port - порт для подключения `15000`
* workers - количество воркеров `2`

### Запустить сервис и монитор
```
php manager.php
```

### Добавить задачу
```
php commander.php --add --path=../tests/fixtures/crap --pattern=/.+/
```

### Очистить очередь
```
php commander.php --clear
```

### Запуск тестов
```
codecept run unit
codecept run acceptance
```
